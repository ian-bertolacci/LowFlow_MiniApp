cmake_minimum_required(VERSION 3.5)
include(${CMAKE_DIR}/utilities.txt)
include(${CMAKE_DIR}/build_variant.txt)

# If Kokkos is enabled
if(${WITH_KOKKOS})
  set(VARIANT_NAME simple_kokkos)
  set(VARIANT_SOURCE_FILES variant_types.cpp variant_science.cpp variant_metrics.cpp variant_configure.cpp variant_setup_teardown.cpp)
  set(VARIANT_LINK_LIBRARIES kokkos dl pthread )

  # Serial Configuration
  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_SERIAL"
  )

  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_SERIAL;ENABLE_VARIANT_METRICS"
  )

  # Threads Configuration
  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_THREADS"
  )

  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_THREADS;ENABLE_VARIANT_METRICS"
  )

  # OpenMP Configuration
  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_OPENMP"
  )

  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_OPENMP;ENABLE_VARIANT_METRICS"
  )

  # CUDA Configuration
  # Enabled only if Kokkos' nvcc_wrapper is the compiler
  if(${USE_KOKKOS_CUDA})
    CREATE_VARIANT_TARGET(
      NAME ${VARIANT}_
      BASE_SRC_FILES ${BASE_SOURCE_FILES}
      VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
      INSTALL_DIR ${INSTALL_BIN_DIR}
      VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
      CONFIG_MACRO_DEFNS "USE_CUDA"
    )

    CREATE_VARIANT_TARGET(
      NAME ${VARIANT}_
      BASE_SRC_FILES ${BASE_SOURCE_FILES}
      VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
      INSTALL_DIR ${INSTALL_BIN_DIR}
      VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
      CONFIG_MACRO_DEFNS "USE_CUDA;ENABLE_VARIANT_METRICS"
    )
  endif() # End cuda configuration

endif() # End if WITH_KOKKOS
