cmake_minimum_required(VERSION 3.5)
include(${CMAKE_DIR}/utilities.txt)
include(${CMAKE_DIR}/build_variant.txt)

set(VARIANT_NAME simple_kokkos)
set(VARIANT_SOURCE_FILES variant_types.cpp variant_science.cpp variant_metrics.cpp variant_configure.cpp variant_setup_teardown.cpp)
set(VARIANT_LINK_LIBRARIES kokkos dl pthread )

# Serial Configuration
CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_SERIAL"
)

CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_SERIAL;ENABLE_VARIANT_METRICS"
)

# Threads Configuration
CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_THREADS"
)

CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_THREADS;ENABLE_VARIANT_METRICS"
)

# OpenMP Configuration
CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_OPENMP"
)

CREATE_VARIANT_TARGET(
  NAME ${VARIANT}
  BASE_SRC_FILES ${BASE_SOURCE_FILES}
  VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
  INSTALL_DIR ${INSTALL_BIN_DIR}
  VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
  CONFIG_MACRO_DEFNS "USE_OPENMP;ENABLE_VARIANT_METRICS"
)

message("${CMAKE_CXX_COMPILER}")
if(${CMAKE_CXX_COMPILER} MATCHES "nvcc_wrapper$")
  message("kokkos::cuda enabled")
  # CUDA Configuration
  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}_
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_CUDA"
    DEBUG_CMAKE_CONFIGURE
  )

  CREATE_VARIANT_TARGET(
    NAME ${VARIANT}_
    BASE_SRC_FILES ${BASE_SOURCE_FILES}
    VARIANT_SRC_FILES ${VARIANT_SOURCE_FILES}
    INSTALL_DIR ${INSTALL_BIN_DIR}
    VARIANT_LINK_LIBS ${VARIANT_LINK_LIBRARIES}
    CONFIG_MACRO_DEFNS "USE_CUDA;ENABLE_VARIANT_METRICS"
    DEBUG_CMAKE_CONFIGURE
  )
endif()
